"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var DOMTraverse={articleWrapper:document.querySelector(".article-wrapper"),mainMenu:document.getElementById("main-menu"),mainTag:document.querySelector("main"),sectionTitles:document.getElementsByClassName("section-title"),allStoriesButton:document.getElementById("show-all-stories"),searchform:document.getElementById("search-form"),searchInput:document.getElementById("search-for-title"),topSpan:document.getElementsByClassName("top-span")[0],storyLoader:document.getElementsByClassName("story-loader"),loginForm:document.getElementById("login-form"),resetForm:document.getElementById("reset-form"),signUpForm:document.getElementById("sign-up-form"),signUpBirthday:document.getElementById("sign-up-birthday"),tovalidate:[].concat(_toConsumableArray(document.getElementsByClassName("validateJS")))},Utility={currentPath:window.location.pathname,getCurrentPath:function(){return"/index.html"==this.currentPath||"/"==this.currentPath?"index":"/html/search-results.html"==this.currentPath?"searchResults":"/html/signup.html"==this.currentPath?"signUp":void 0},route:function(e,t){localStorage.setItem(e,t),window.location.href=Utility.searchResultLocation},searchResultLocation:"/html/search-results.html",storyStorage:"https://api.myjson.com/bins/uneyp",xhr:new XMLHttpRequest},LoadStories={createRequest:function(e){function t(e){var t=document.createElement("span");t.innerText="Oeps, er ging iets fout. Probeer de pagina opnieuw te laden om de fout op te lossen!",DOMTraverse.articleWrapper.appendChild(t)}var n=Utility.xhr;n.open("GET",Utility.storyStorage,!0);var i=void 0;n.onprogress=function(){void 0==i&&(LoadStories.createLoader(DOMTraverse.articleWrapper),i=!0)},n.onload=function(){if(200==this.status){var t=JSON.parse(this.responseText);LoadStories.createArticles(t,e)}},n.onerror=function(e){t()},n.send()},createLoader:function(e){for(var t=document.createElement("ul"),n=0;n<12;n++){var i=document.createElement("li");t.appendChild(i)}t.classList.add("story-loader"),e.appendChild(t)},createArticles:function(e,t){function n(){var n=[];return"input"==t?(a=localStorage.getItem(t),e.stories.forEach(function(e){"allStories"===a?n.push(e.title):(e.title.toLowerCase().includes(a.toLowerCase())||-1!=e.text.indexOf(a.toLowerCase()))&&n.push(e.title)})):"readingList"==t&&(a=[localStorage.getItem(t).split(",")],e.stories.forEach(function(e,t){a.forEach(function(i){void 0!=i[t]&&n.push(e.title)})})),n}function i(t){t.forEach(function(t,n){e.stories.forEach(function(e){return LoadStories.matchStorageToRequest(t,e,n)})})}var a=void 0;!function(){var e=n();if(0==e.length||void 0==e){LoadStories.hideSortButton();var r=document.createElement("span");r.innerHTML="Helaas, er zijn geen matches gevonden met de opgegeven input: "+a+".<br>Probeer een ander zoekwoord, of gebruik de filters om te zoeken.",DOMTraverse.articleWrapper.style.backgroundColor="white",DOMTraverse.articleWrapper.appendChild(r)}else if(e.length>25){var s=e.slice(0,25);e.slice(25);i(s),"readingList"==t&&DOMTraverse.articleWrapper.classList.add("reading-list-js-results"),DOMTraverse.articleWrapper.appendChild(function(){var e=document.createElement("button");return e.setAttribute("type","button"),e.setAttribute("aria-label","Toon nog 25 verhalen"),e.classList.add("btn","btn-main"),e.innerText="Toon meer verhalen",e}())}else"readingList"==t&&DOMTraverse.articleWrapper.parentElement.classList.add("reading-list-js-results"),i(e);[].concat(_toConsumableArray(DOMTraverse.sectionTitles)).forEach(function(t){"Resultaten"!=t.innerHTML&&"Leeslijst"!=t.innerHTML||(t.innerHTML+=" - "+e.length)})}(),DOMTraverse.articleWrapper.removeChild(DOMTraverse.storyLoader[0])},hideSortButton:function(){document.getElementById("toggle-button-group-sort").style.display="none"},matchStorageToRequest:function(e,t,n){if(e==t.title){var i=t.title.toLowerCase(),a=t.nr,r=t.by,s=t.text.substr(0,150),o=s=t.text.substr(0,Math.min(s.length,s.lastIndexOf(" "))),l=t.text.substring(Math.max(s.length,s.lastIndexOf(" ")));DOMTraverse.articleWrapper.innerHTML+=LoadStories.Article("http://lorempixel.com/400/200/",r,i,a,o,l,n)}},Article:function(e,t,n,i,a,r,s){return'\n        <article>\n            <header class="article-header">\n                <img src='+e+' alt="search-result-image" onclick="Microinteractions.toggleJavascript.call(this)" data-target="rest-text-'+s+'">\n                <span>Door: '+t+"</span>\n                <div><h3>"+n+" ("+i+')</h3></div>\n            </header>\n            <p onclick="Microinteractions.toggleJavascript.call(this)" aria-label="Open volledig verhaal" data-target="rest-text-'+s+'">\n                '+a+'\n                <span id="rest-text-'+s+'">'+r+'</span>\n            </p>\n            <footer>\n                <button type="button" class="btn btn-main" onClick="ResultPage.addActiveClass.call(this)" id=read-later-'+n+'>Toevoegen aan leeslijst</button>\n                <button type="button" class="btn btn-main">Downloaden</button>\n            </footer>\n         </article>\n        '}},Microinteractions={toggleJavascript:function(){document.getElementById(""+this.dataset.target).classList.toggle("js-active"),Microinteractions.determineElClicked.call(this)},determineElClicked:function(){function e(e){return"/"==Utility.currentPath?"./dist/img/"+e+".svg":Utility.currentPath.includes("stories")?"../../dist/img/"+e+".svg":"../dist/img/"+e+".svg"}var t=this.dataset.target;t.includes("main-menu")?"Account icon"==this.firstElementChild.alt?(e("multiply"),DOMTraverse.mainTag.classList.add("js-active"),this.firstElementChild.alt="Sluit icon",this.firstElementChild.src=e("multiply"),this.setAttribute("aria-label","Sluit hoofdmenu")):(DOMTraverse.mainTag.classList.remove("js-active"),this.firstElementChild.alt="Account icon",this.firstElementChild.src=e("account"),this.setAttribute("aria-label","Open hoofdmenu")):t.includes("result-page-search-form")||(t.includes("rest-text")?this.classList.contains("js-active")?(this.setAttribute("aria-label","Open volledig verhaal"),this.classList.remove("js-active")):(this.setAttribute("aria-label","Sluit volledig verhaal"),this.classList.add("js-active")):t.includes("button-group-sort")?this.parentElement.classList.toggle("js-active"):this.classList.toggle("js-active"))},loopOverDataTargets:void[].concat(_toConsumableArray(document.querySelectorAll("[data-target]"))).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),Microinteractions.toggleJavascript.call(this)})})},IndexPage={setFormListeners:function(){DOMTraverse.searchform.addEventListener("submit",function(e){e.preventDefault();var t=DOMTraverse.searchInput.value;this.reset(),Utility.route("input",t)}),DOMTraverse.allStoriesButton.addEventListener("click",function(){return Utility.route("input","allStories")})},getReadingList:function(e){if(null!=window.localStorage.getItem("login")||null!=window.localStorage.getItem("signUp")){var t=localStorage.getItem("readingList");if(null===t||0==t.length)LoadStories.hideSortButton(),this.readingListNotFound();else{var n=DOMTraverse.articleWrapper.classList;n.contains("no-results")&&n.remove("no-results"),LoadStories.createRequest(e)}}else{var i=document.createElement("span");i.innerHTML="Om je leeslijst te zien, moet je ingelogd zijn. <a href='/html/signup.html'>Dit kunt u hier doen</a>.",LoadStories.hideSortButton(),DOMTraverse.articleWrapper.parentElement.classList.add("reading-list-js-no-login"),DOMTraverse.articleWrapper.appendChild(i)}},readingListNotFound:function(){var e=DOMTraverse.articleWrapper,t=document.createElement("i"),n=document.createElement("span");t.setAttribute("aria-label","Leeslijst icon"),n.innerHTML="Er zijn geen verhalen gevonden in uw leeslijst.<br><a href='#search-form'>Ga op zoek naar nieuwe ervaringen!</a>",e.classList.add("no-results"),e.appendChild(t),e.appendChild(n)}},SignUpPage={Constraint:{getDate:function(){function e(e){return e<10?e="0"+e:e}var t=new Date,n=t.getDate(),i=t.getMonth()+1,a=t.getFullYear();return t=e(n)+"/"+e(i)+"/"+a},setCurrentDate:function(){var e=this.getDate();DOMTraverse.signUpBirthday.setAttribute("max",e)},getConstraints:function(){return{email:["[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,3}$","Een email bestaat uit letters en nummers, een @ en minstens één punt"],name:["^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z]*)*$","Een volledige naam bestaat uit enkel woorden en spaties."],password:["^([a-zA-Z0-9@*#]{8,15})$","Een goed wachtwoord bestaat uit minimaal 8 tekens, waarvan minstens één hoofd- en kleine letter en een nummer."]}},matchConstraintToInputField:function(e,t){var n=this.getConstraints(),i=!0,a=!1,r=void 0;try{for(var s,o=Object.keys(n)[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;e.includes(l)&&this.createConstraint(n,l,t)}}catch(e){a=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}},createConstraint:function(e,t,n){var i=new RegExp(e[t][0]);0===n.value.length?n.classList.remove("js-active"):n.classList.add("js-active"),i.test(n.value)?n.setCustomValidity(""):n.setCustomValidity(e[t][1])},checkElements:function(){var e=this;DOMTraverse.tovalidate.forEach(function(t){t.addEventListener("keyup",function(){t.classList.contains("password")?e.matchConstraintToInputField("password",t):t.classList.contains("email")?e.matchConstraintToInputField("email",t):t.classList.contains("name")&&e.matchConstraintToInputField("name",t)})})}},UserActions:{userLogin:function(){function e(e){localStorage.setItem("login",JSON.stringify(e)),window.location.href="/index.html"}DOMTraverse.loginForm.addEventListener("submit",function(t){t.preventDefault(),e({email:this.querySelector("#login-email").value,password:this.querySelector("#login-password").value})})},userPasswordReset:function(){function e(e){localStorage.setItem("reset",e)}DOMTraverse.resetForm.addEventListener("submit",function(t){t.preventDefault(),e(this.querySelector("#reset-password").value)})},userSignUp:function(){function e(e){localStorage.setItem("signUp",JSON.stringify(e)),window.location.href="/index.html"}DOMTraverse.signUpForm.addEventListener("submit",function(t){t.preventDefault(),e({birthday:this.querySelector("#sign-up-birthday").value,email:this.querySelector("#sign-up-email").value,name:this.querySelector("#sign-up-name").value,nationality:this.querySelector("#sign-up-nationality").value,password:this.querySelector("#sign-up-password").value})})},init:function(){this.userLogin(),this.userPasswordReset(),this.userSignUp()}}},ResultPage={readingListArray:[],addActiveClass:function(){var e=this;this.classList.toggle("js-active"),setTimeout(function(){ResultPage.addToReadingList.call(e),ResultPage.showTopMessage.call(e)},1500)},addToReadingList:function(){var e=this.id.slice(this.id.lastIndexOf("-")+1);window.localStorage.getItem("readingList");ResultPage.readingListArray.push(e),window.localStorage.setItem("readingList",ResultPage.readingListArray)},showTopMessage:function(){var e=this;DOMTraverse.topSpan.classList.add("js-active"),setTimeout(function(){e.classList.remove("js-active"),DOMTraverse.topSpan.classList.remove("js-active")},3e3)}},Navigation={getLoginOrSignup:function(e){null!=window.localStorage.getItem("login")||null!=window.localStorage.getItem("signUp")?"index"==e?this.changeLoginNode("Uitloggen",!0,!0):"searchResults"==e&&this.changeLoginNode("Uitloggen",!0,!1):this.changeLoginNode("Inloggen")},changeLoginNode:function(e,t,n){var i=this.getNodes();i.loginNodeAnchor.innerText=e,!0===t&&!0===n?i.firstLoginSibling.insertAdjacentHTML("beforeBegin",'\n                    <li class="dynamic-js">\n                        <a href="./html/settings.html" role="menuitem">Accountinstellingen</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="./html/reading-history.html" role="menuitem">Leesgeschiedenis</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="#reading-list" role="menuitem">Leeslijst</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="./html/notifications.html" role="menuitem">Notificaties</a>\n                    </li>\n                '):!0===t&&!0!==n?i.firstLoginSibling.insertAdjacentHTML("beforeBegin",'\n                    <li class="dynamic-js">\n                        <a href="settings.html" role="menuitem">Accountinstellingen</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="reading-history.html" role="menuitem">Leesgeschiedenis</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="../index.html#reading-list" role="menuitem">Leeslijst</a>\n                    </li>\n                    <li class="dynamic-js">\n                        <a href="notifications.html" role="menuitem">Notificaties</a>\n                    </li>\n                '):this.removeAddedMenuItems()},getNodes:function(){var e=DOMTraverse.mainMenu.querySelector("#login-node");return{loginNode:e,menuList:e.parentElement,loginNodeAnchor:e.firstElementChild,firstLoginSibling:e.nextElementSibling}},removeAddedMenuItems:function(){var e=this.getNodes(),t=[].concat(_toConsumableArray(e.menuList.querySelectorAll(".dynamic-js")));t.forEach(function(e,n){t.splice(n,1)})}},onLoad=function(){var e=Utility.getCurrentPath();"index"==e?(IndexPage.getReadingList("readingList"),IndexPage.setFormListeners(),Navigation.getLoginOrSignup("index")):"searchResults"==e?(LoadStories.createRequest("input"),Navigation.getLoginOrSignup("searchResults")):"signUp"==e&&(SignUpPage.Constraint.checkElements(),SignUpPage.Constraint.setCurrentDate(),SignUpPage.UserActions.init())}();